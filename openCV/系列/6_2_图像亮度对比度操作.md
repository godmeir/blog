###一：亮度和对比度调整的理论依据
首先我们给出算子的概念。一般的图像处理算子都是一个函数，它接受一个或多个输入图像，并产生输出图像。下式给出了算子的一般形式：

g(x) = h(f0(x)......fn(x))

今天我们所讲解的图像亮度和对比度的调整操作，其实属于图像处理变换中比较简单的一种——点操作（pointoperators）。点操作有一个特点，仅仅根据输入像素值（有时可加上某些全局信息或参数），来计算相应的输出像素值。这类算子包括亮度（brightness）和对比度（contrast）调整，以及颜色校正（colorcorrection）和变换（transformations）。
 
最两种常用的点操作（或者说点算子），很显然，是乘上一个常数（对应对比度的调节）以及加上一个常数（对应亮度值的调节）。用公式表示出来就是这样：

g(x) = a * f(x) + b

看到这个式子，我们关于图像亮度和对比度调整的策略就呼之欲出了。

其中：

* 参数f(x)表示源图像像素。
* 参数g(x) 表示输出图像像素。
* 参数a（需要满足a>0）被称为增益（gain），常常被用来控制图像的对比度。
*  参数b通常被称为偏置（bias），常常被用来控制图像的亮度。


而更近一步，我们这样改写这个式子：

g(i,j) = a * f(i,j) + b

其中，i 和 j 表示像素位于第i行 和 第j列 。
那么，这个式子就可以用来作为我们在OpenCV中控制图像的亮度和对比度的理论公式了。

###二：关于访问图片中的像素
而为了执行这个运算  ，我们需要访问图像的每一个像素。因为是对GBR图像进行运算，每个像素有三个值（G、B、R），所以我们必须分别访问它们（PS:OpenCV中的图像存储模式为GBR）。以下是访问像素的代码片段，三个for循环解决问题：

<pre>
//三个for循环，执行运算 new_image(i,j) =a*image(i,j) + b  
for(int y = 0; y < image.rows; y++ )  
{  
       for(int x = 0; x < image.cols; x++ )  
       {  
              for(int c = 0; c < 3; c++ )  
              {  
                     new_image.at<Vec3b>(y,x)[c]= saturate_cast<uchar>( (g_nContrastValue*0.01)*(image.at<Vec3b>(y,x)[c] ) + g_nBrightValue );  
              }  
       }  
}  
</pre>

让我们分三个方面进行讲解：

* 为了访问图像的每一个像素，我们使用这样的语法： image.at<Vec3b>(y,x)[c]	其中，y是像素所在的行， x是像素所在的列， c是R、G、B（对应0、1、2）其中之一。
* 
因为我们的运算结果可能超出像素取值范围（溢出），还可能是非整数（如果是浮点数的话），所以我们要用saturate_cast对结果进行转换，以确保它为有效值。
* 
这里的a也就是对比度，一般为了观察的效果，取值为0.0到3.0的浮点值，但是我们的轨迹条一般取值都会整数，所以在这里我们可以，将其代表对比度值的nContrastValue参数设为0到300之间的整型，在最后的式子中乘以一个0.01，这样就可以完成轨迹条中300个不同取值的变化。所以在式子中，我们会看到saturate_cast<uchar>( (g_nContrastValue*0.01)*(image.at<Vec3b>(y,x)[c] ) + g_nBrightValue )中的g_nContrastValue*0.01。

###三：图像对比度、亮度值调整示例程序
这个示例程序用两个轨迹条分别控制对比度和亮度值，有一定的可玩性。废话不多说，上代码吧：
<pre>
//-----------------------------------【程序说明】----------------------------------------------  
//  程序名称:：【OpenCV入门教程之四】 创建Trackbar&图像对比度、亮度值调整 配套博文源码  
// VS2010版  OpenCV版本：2.4.8  
//  2014年3月18 日 Create by 浅墨  
//------------------------------------------------------------------------------------------------  
   
   
//-----------------------------------【头文件包含部分】---------------------------------------  
//     描述：包含程序所依赖的头文件  
//----------------------------------------------------------------------------------------------  
#include <opencv2/core/core.hpp>  
#include<opencv2/highgui/highgui.hpp>  
#include"opencv2/imgproc/imgproc.hpp"  
#include <iostream>  
   
//-----------------------------------【命名空间声明部分】---------------------------------------  
//     描述：包含程序所使用的命名空间  
//-----------------------------------------------------------------------------------------------    
using namespace std;  
using namespace cv;  
   
   
//-----------------------------------【全局函数声明部分】--------------------------------------  
//     描述：全局函数声明  
//-----------------------------------------------------------------------------------------------  
static void ContrastAndBright(int, void *);  
   
//-----------------------------------【全局变量声明部分】--------------------------------------  
//     描述：全局变量声明  
//-----------------------------------------------------------------------------------------------  
int g_nContrastValue; //对比度值  
int g_nBrightValue;  //亮度值  
Mat g_srcImage,g_dstImage;  
//-----------------------------------【main( )函数】--------------------------------------------  
//     描述：控制台应用程序的入口函数，我们的程序从这里开始  
//-----------------------------------------------------------------------------------------------  
int main(  )  
{  
       //改变控制台前景色和背景色  
       system("color5F");   
   
       //读入用户提供的图像  
       g_srcImage= imread( "pic1.jpg");  
              if(!g_srcImage.data ) { printf("Oh，no，读取g_srcImage图片错误~！\n"); return false; }  
       g_dstImage= Mat::zeros( g_srcImage.size(), g_srcImage.type() );  
   
       //设定对比度和亮度的初值  
       g_nContrastValue=80;  
       g_nBrightValue=80;  
   
       //创建窗口  
       namedWindow("【效果图窗口】", 1);  
   
       //创建轨迹条  
       createTrackbar("对比度：", "【效果图窗口】",&g_nContrastValue,300,ContrastAndBright );  
       createTrackbar("亮   度：","【效果图窗口】",&g_nBrightValue,200,ContrastAndBright );  
        
       //调用回调函数  
       ContrastAndBright(g_nContrastValue,0);  
       ContrastAndBright(g_nBrightValue,0);  
        
       //输出一些帮助信息  
       cout<<endl<<"\t嗯。好了，请调整滚动条观察图像效果~\n\n"  
                     <<"\t按下“q”键时，程序退出~!\n"  
                     <<"\n\n\t\t\t\tby浅墨";  
   
       //按下“q”键时，程序退出  
   while(char(waitKey(1)) != 'q') {}  
       return0;  
}  
   
   
//-----------------------------【ContrastAndBright( )函数】------------------------------------  
//     描述：改变图像对比度和亮度值的回调函数  
//-----------------------------------------------------------------------------------------------  
static void ContrastAndBright(int, void *)  
{  
   
       //创建窗口  
       namedWindow("【原始图窗口】", 1);  
   
       //三个for循环，执行运算 g_dstImage(i,j) =a*g_srcImage(i,j) + b  
       for(int y = 0; y < g_srcImage.rows; y++ )  
       {  
              for(int x = 0; x < g_srcImage.cols; x++ )  
              {  
                     for(int c = 0; c < 3; c++ )  
                     {  
                            g_dstImage.at<Vec3b>(y,x)[c]= saturate_cast<uchar>( (g_nContrastValue*0.01)*(g_srcImage.at<Vec3b>(y,x)[c] ) + g_nBrightValue );  
                     }  
              }  
       }  
   
       //显示图像  
       imshow("【原始图窗口】", g_srcImage);  
       imshow("【效果图窗口】", g_dstImage);  
}  
</pre>